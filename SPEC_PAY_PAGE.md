# Pay Page (pay.ludens.school) — Premium Tokens

## Цель

Статический pay-сайт, где игрок:

- попадает по ссылке из клиента (желательно с предзаполненным логином),
- вводит/проверяет `account`,
- выбирает количество `tokens` (1..1_000_000),
- выбирает валюту отображения/оплаты (на MVP — UAH),
- жмёт “Оплатить” и уезжает в monobank по редиректу backend-а,
- после оплаты видит страницу “Успех/Проверяем/Ошибка” с понятными действиями.

## Ограничения

- Сайт статический: без БД, без секретов, без хранения токенов/цен.
- Цена/сумма считается на бекенде; фронт **НЕ** отправляет `amount`.
- Фронт отправляет только: `account`, `tokens`, `currency`.
- Backend endpoint: `https://api.ludens.school/create`.
- Домен: `pay.ludens.school`.

## Входные URL-параметры

- `acc` или `account` → предзаполнить поле аккаунта.
- Пример: `https://pay.ludens.school/?acc=MyLogin`

## UI (MVP)

Одна страница без хедера/футера:

- Полоса/место под арт сервера (вверху страницы), чтобы было видно, что это “своя” страница.
- Заголовок: “Premium Tokens”
- Пояснение: “Токены начисляются на аккаунт. Проверь имя аккаунта.”
- Account / имя аккаунта: `input[type=text]`
- Tokens:
  - numeric input + slider (синхронизированы)
  - input: min=1, max=1_000_000
  - slider: min=1, max=5_000
  - пресеты: 10 / 50 / 100 / 500
- Currency:
  - минимум UAH
  - UI подготовлен под EUR/USD (disabled)
- Кнопка “Оплатить”
- Блок ошибок/валидации
- Адаптивно и читабельно на мобиле

## Валидация (front)

- `account`: 2..32 символа, только `[A-Za-z0-9_]`
- `tokens`: integer, 1..1_000_000
- Если невалидно — не отправлять, показать ошибку.

## Поведение “Оплатить”

1) Валидировать.
2) Собрать URL:

`https://api.ludens.school/create?account=...&tokens=...&currency=...`

3) Сделать полный редирект:

`window.location.href = url`

## Страницы результата

### Thanks

- URL: `/thanks.html`
- Текст:
  - “Если оплата прошла, токены начислятся в течение ~N минут.”
  - “Вернись в игру и нажми ‘Refresh balance’ (или перезайди).”
- Кнопка “Вернуться на главную” (на `/`)

Примечание: monobank может редиректить на `redirectUrl` всегда, даже если статус не `success`,
поэтому формулировка “thanks” = “обрабатывается/проверь баланс”, без обещаний.

### Error

- URL: `/error.html`
- Текст:
  - “Оплата не подтверждена / произошла ошибка.”
  - “Попробуй ещё раз или свяжись с нами.”
- Кнопка “Попробовать снова” (на `/`)

## Техническая реализация (в этом репо)

- Реализовано как “чистый статик” в `public/pay/**`:
  - `public/pay/index.html`
  - `public/pay/thanks.html`
  - `public/pay/error.html`
  - `public/pay/assets/styles.css`
  - `public/pay/assets/app.js`
- Константа в JS: `BACKEND_BASE = "https://api.ludens.school"`.

Примечание по деплою:

- Для `https://ludens.school/pay/` эти файлы уже подходят как есть (GitHub Pages отдаст `pay/index.html` как `pay/`).
- Для отдельного домена `pay.ludens.school` удобнее деплоить содержимое `public/pay/` как корень сайта (чтобы pay-страница была по `/`).

## Этапы внедрения (от простого к сложному)

1) **MVP redirect**
   - форма + валидация
   - синхронизация input+slider
   - редирект на backend `/create`
   - страницы `thanks`/`error`

2) **Полировка UX**
   - форматирование чисел (1 000 000)
   - более ясные ошибки (inline)
   - блок “что будет дальше” + подсказки

3) **Статус инвойса (когда backend даст endpoint)**
   - параметр `invoiceId` в query
   - кнопка “Проверить статус” + polling

4) **Расширение валют**
   - включить EUR/USD
   - помнить выбор в `localStorage`

## Definition of Done (MVP)

- Открывая `/?acc=Test`, поле аккаунта заполнено “Test”.
- Валидация работает.
- “Оплатить” редиректит на `https://api.ludens.school/create?...`.
- `thanks.html` и `error.html` существуют и выглядят нормально.
- Нет секретов и нет логики расчёта цены на фронте.
